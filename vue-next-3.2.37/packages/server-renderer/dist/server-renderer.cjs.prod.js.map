{"version":3,"file":"server-renderer.cjs.prod.js","sources":["../src/helpers/ssrRenderAttrs.ts","../src/helpers/ssrCompile.ts","../src/helpers/ssrRenderTeleport.ts","../src/render.ts","../src/renderToString.ts","../src/renderToStream.ts","../src/helpers/ssrRenderComponent.ts","../src/helpers/ssrRenderSlot.ts","../src/helpers/ssrInterpolate.ts","../src/helpers/ssrRenderList.ts","../src/helpers/ssrRenderSuspense.ts","../src/helpers/ssrGetDirectiveProps.ts","../src/helpers/ssrVModelHelpers.ts","../src/index.ts"],"sourcesContent":["import { escapeHtml, stringifyStyle } from '@vue/shared'\r\nimport {\r\n  normalizeClass,\r\n  normalizeStyle,\r\n  propsToAttrMap,\r\n  isString,\r\n  isOn,\r\n  isSSRSafeAttrName,\r\n  isBooleanAttr,\r\n  includeBooleanAttr,\r\n  makeMap\r\n} from '@vue/shared'\r\n\r\n// leading comma for empty string \"\"\r\nconst shouldIgnoreProp = makeMap(\r\n  `,key,ref,innerHTML,textContent,ref_key,ref_for`\r\n)\r\n\r\nexport function ssrRenderAttrs(\r\n  props: Record<string, unknown>,\r\n  tag?: string\r\n): string {\r\n  let ret = ''\r\n  for (const key in props) {\r\n    if (\r\n      shouldIgnoreProp(key) ||\r\n      isOn(key) ||\r\n      (tag === 'textarea' && key === 'value')\r\n    ) {\r\n      continue\r\n    }\r\n    const value = props[key]\r\n    if (key === 'class') {\r\n      ret += ` class=\"${ssrRenderClass(value)}\"`\r\n    } else if (key === 'style') {\r\n      ret += ` style=\"${ssrRenderStyle(value)}\"`\r\n    } else {\r\n      ret += ssrRenderDynamicAttr(key, value, tag)\r\n    }\r\n  }\r\n  return ret\r\n}\r\n\r\n// render an attr with dynamic (unknown) key.\r\nexport function ssrRenderDynamicAttr(\r\n  key: string,\r\n  value: unknown,\r\n  tag?: string\r\n): string {\r\n  if (!isRenderableValue(value)) {\r\n    return ``\r\n  }\r\n  const attrKey =\r\n    tag && tag.indexOf('-') > 0\r\n      ? key // preserve raw name on custom elements\r\n      : propsToAttrMap[key] || key.toLowerCase()\r\n  if (isBooleanAttr(attrKey)) {\r\n    return includeBooleanAttr(value) ? ` ${attrKey}` : ``\r\n  } else if (isSSRSafeAttrName(attrKey)) {\r\n    return value === '' ? ` ${attrKey}` : ` ${attrKey}=\"${escapeHtml(value)}\"`\r\n  } else {\r\n    console.warn(\r\n      `[@vue/server-renderer] Skipped rendering unsafe attribute name: ${attrKey}`\r\n    )\r\n    return ``\r\n  }\r\n}\r\n\r\n// Render a v-bind attr with static key. The key is pre-processed at compile\r\n// time and we only need to check and escape value.\r\nexport function ssrRenderAttr(key: string, value: unknown): string {\r\n  if (!isRenderableValue(value)) {\r\n    return ``\r\n  }\r\n  return ` ${key}=\"${escapeHtml(value)}\"`\r\n}\r\n\r\nfunction isRenderableValue(value: unknown): boolean {\r\n  if (value == null) {\r\n    return false\r\n  }\r\n  const type = typeof value\r\n  return type === 'string' || type === 'number' || type === 'boolean'\r\n}\r\n\r\nexport function ssrRenderClass(raw: unknown): string {\r\n  return escapeHtml(normalizeClass(raw))\r\n}\r\n\r\nexport function ssrRenderStyle(raw: unknown): string {\r\n  if (!raw) {\r\n    return ''\r\n  }\r\n  if (isString(raw)) {\r\n    return escapeHtml(raw)\r\n  }\r\n  const styles = normalizeStyle(raw)\r\n  return escapeHtml(stringifyStyle(styles))\r\n}\r\n","import { ComponentInternalInstance, ComponentOptions, warn } from 'vue'\r\nimport { compile } from '@vue/compiler-ssr'\r\nimport { extend, generateCodeFrame, isFunction, NO } from '@vue/shared'\r\nimport { CompilerError, CompilerOptions } from '@vue/compiler-core'\r\nimport { PushFn } from '../render'\r\n\r\ntype SSRRenderFunction = (\r\n  context: any,\r\n  push: PushFn,\r\n  parentInstance: ComponentInternalInstance\r\n) => void\r\n\r\nconst compileCache: Record<string, SSRRenderFunction> = Object.create(null)\r\n\r\nexport function ssrCompile(\r\n  template: string,\r\n  instance: ComponentInternalInstance\r\n): SSRRenderFunction {\r\n  if (!__NODE_JS__) {\r\n    throw new Error(\r\n      `On-the-fly template compilation is not supported in the ESM build of ` +\r\n        `@vue/server-renderer. All templates must be pre-compiled into ` +\r\n        `render functions.`\r\n    )\r\n  }\r\n\r\n  // TODO: This is copied from runtime-core/src/component.ts and should probably be refactored\r\n  const Component = instance.type as ComponentOptions\r\n  const { isCustomElement, compilerOptions } = instance.appContext.config\r\n  const { delimiters, compilerOptions: componentCompilerOptions } = Component\r\n\r\n  const finalCompilerOptions: CompilerOptions = extend(\r\n    extend(\r\n      {\r\n        isCustomElement,\r\n        delimiters\r\n      },\r\n      compilerOptions\r\n    ),\r\n    componentCompilerOptions\r\n  )\r\n\r\n  finalCompilerOptions.isCustomElement =\r\n    finalCompilerOptions.isCustomElement || NO\r\n  finalCompilerOptions.isNativeTag = finalCompilerOptions.isNativeTag || NO\r\n\r\n  const cacheKey = JSON.stringify(\r\n    {\r\n      template,\r\n      compilerOptions: finalCompilerOptions\r\n    },\r\n    (key, value) => {\r\n      return isFunction(value) ? value.toString() : value\r\n    }\r\n  )\r\n\r\n  const cached = compileCache[cacheKey]\r\n  if (cached) {\r\n    return cached\r\n  }\r\n\r\n  finalCompilerOptions.onError = (err: CompilerError) => {\r\n    if (__DEV__) {\r\n      const message = `[@vue/server-renderer] Template compilation error: ${err.message}`\r\n      const codeFrame =\r\n        err.loc &&\r\n        generateCodeFrame(\r\n          template as string,\r\n          err.loc.start.offset,\r\n          err.loc.end.offset\r\n        )\r\n      warn(codeFrame ? `${message}\\n${codeFrame}` : message)\r\n    } else {\r\n      throw err\r\n    }\r\n  }\r\n\r\n  const { code } = compile(template, finalCompilerOptions)\r\n  return (compileCache[cacheKey] = Function('require', code)(require))\r\n}\r\n","import { ComponentInternalInstance, ssrContextKey } from 'vue'\r\nimport { createBuffer, PushFn, SSRBufferItem, SSRContext } from '../render'\r\n\r\nexport function ssrRenderTeleport(\r\n  parentPush: PushFn,\r\n  contentRenderFn: (push: PushFn) => void,\r\n  target: string,\r\n  disabled: boolean,\r\n  parentComponent: ComponentInternalInstance\r\n) {\r\n  parentPush('<!--teleport start-->')\r\n\r\n  const context = parentComponent.appContext.provides[\r\n    ssrContextKey as any\r\n  ] as SSRContext\r\n  const teleportBuffers =\r\n    context.__teleportBuffers || (context.__teleportBuffers = {})\r\n  const targetBuffer = teleportBuffers[target] || (teleportBuffers[target] = [])\r\n  // record current index of the target buffer to handle nested teleports\r\n  // since the parent needs to be rendered before the child\r\n  const bufferIndex = targetBuffer.length\r\n\r\n  let teleportContent: SSRBufferItem\r\n\r\n  if (disabled) {\r\n    contentRenderFn(parentPush)\r\n    teleportContent = `<!--teleport anchor-->`\r\n  } else {\r\n    const { getBuffer, push } = createBuffer()\r\n    contentRenderFn(push)\r\n    push(`<!--teleport anchor-->`)\r\n    teleportContent = getBuffer()\r\n  }\r\n\r\n  targetBuffer.splice(bufferIndex, 0, teleportContent)\r\n  parentPush('<!--teleport end-->')\r\n}\r\n","import {\r\n  Comment,\r\n  Component,\r\n  ComponentInternalInstance,\r\n  DirectiveBinding,\r\n  Fragment,\r\n  FunctionalComponent,\r\n  mergeProps,\r\n  ssrUtils,\r\n  Static,\r\n  Text,\r\n  VNode,\r\n  VNodeArrayChildren,\r\n  VNodeProps,\r\n  warn\r\n} from 'vue'\r\nimport {\r\n  escapeHtml,\r\n  escapeHtmlComment,\r\n  isFunction,\r\n  isPromise,\r\n  isString,\r\n  isVoidTag,\r\n  ShapeFlags,\r\n  isArray,\r\n  NOOP\r\n} from '@vue/shared'\r\nimport { ssrRenderAttrs } from './helpers/ssrRenderAttrs'\r\nimport { ssrCompile } from './helpers/ssrCompile'\r\nimport { ssrRenderTeleport } from './helpers/ssrRenderTeleport'\r\n\r\nconst {\r\n  createComponentInstance,\r\n  setCurrentRenderingInstance,\r\n  setupComponent,\r\n  renderComponentRoot,\r\n  normalizeVNode\r\n} = ssrUtils\r\n\r\nexport type SSRBuffer = SSRBufferItem[] & { hasAsync?: boolean }\r\nexport type SSRBufferItem = string | SSRBuffer | Promise<SSRBuffer>\r\nexport type PushFn = (item: SSRBufferItem) => void\r\nexport type Props = Record<string, unknown>\r\n\r\nexport type SSRContext = {\r\n  [key: string]: any\r\n  teleports?: Record<string, string>\r\n  __teleportBuffers?: Record<string, SSRBuffer>\r\n}\r\n\r\n// Each component has a buffer array.\r\n// A buffer array can contain one of the following:\r\n// - plain string\r\n// - A resolved buffer (recursive arrays of strings that can be unrolled\r\n//   synchronously)\r\n// - An async buffer (a Promise that resolves to a resolved buffer)\r\nexport function createBuffer() {\r\n  let appendable = false\r\n  const buffer: SSRBuffer = []\r\n  return {\r\n    getBuffer(): SSRBuffer {\r\n      // Return static buffer and await on items during unroll stage\r\n      return buffer\r\n    },\r\n    push(item: SSRBufferItem) {\r\n      const isStringItem = isString(item)\r\n      if (appendable && isStringItem) {\r\n        buffer[buffer.length - 1] += item as string\r\n      } else {\r\n        buffer.push(item)\r\n      }\r\n      appendable = isStringItem\r\n      if (isPromise(item) || (isArray(item) && item.hasAsync)) {\r\n        // promise, or child buffer with async, mark as async.\r\n        // this allows skipping unnecessary await ticks during unroll stage\r\n        buffer.hasAsync = true\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nexport function renderComponentVNode(\r\n  vnode: VNode,\r\n  parentComponent: ComponentInternalInstance | null = null,\r\n  slotScopeId?: string\r\n): SSRBuffer | Promise<SSRBuffer> {\r\n  const instance = createComponentInstance(vnode, parentComponent, null)\r\n  const res = setupComponent(instance, true /* isSSR */)\r\n  const hasAsyncSetup = isPromise(res)\r\n  const prefetches = instance.sp /* LifecycleHooks.SERVER_PREFETCH */\r\n  if (hasAsyncSetup || prefetches) {\r\n    let p: Promise<unknown> = hasAsyncSetup\r\n      ? (res as Promise<void>)\r\n      : Promise.resolve()\r\n    if (prefetches) {\r\n      p = p\r\n        .then(() =>\r\n          Promise.all(prefetches.map(prefetch => prefetch.call(instance.proxy)))\r\n        )\r\n        // Note: error display is already done by the wrapped lifecycle hook function.\r\n        .catch(() => {})\r\n    }\r\n    return p.then(() => renderComponentSubTree(instance, slotScopeId))\r\n  } else {\r\n    return renderComponentSubTree(instance, slotScopeId)\r\n  }\r\n}\r\n\r\nfunction renderComponentSubTree(\r\n  instance: ComponentInternalInstance,\r\n  slotScopeId?: string\r\n): SSRBuffer | Promise<SSRBuffer> {\r\n  const comp = instance.type as Component\r\n  const { getBuffer, push } = createBuffer()\r\n  if (isFunction(comp)) {\r\n    let root = renderComponentRoot(instance)\r\n    // #5817 scope ID attrs not falling through if functional component doesn't\r\n    // have props\r\n    if (!(comp as FunctionalComponent).props) {\r\n      for (const key in instance.attrs) {\r\n        if (key.startsWith(`data-v-`)) {\r\n          ;(root.props || (root.props = {}))[key] = ``\r\n        }\r\n      }\r\n    }\r\n    renderVNode(push, (instance.subTree = root), instance, slotScopeId)\r\n  } else {\r\n    if (\r\n      (!instance.render || instance.render === NOOP) &&\r\n      !instance.ssrRender &&\r\n      !comp.ssrRender &&\r\n      isString(comp.template)\r\n    ) {\r\n      comp.ssrRender = ssrCompile(comp.template, instance)\r\n    }\r\n\r\n    // perf: enable caching of computed getters during render\r\n    // since there cannot be state mutations during render.\r\n    for (const e of instance.scope.effects) {\r\n      if (e.computed) e.computed._cacheable = true\r\n    }\r\n\r\n    const ssrRender = instance.ssrRender || comp.ssrRender\r\n    if (ssrRender) {\r\n      // optimized\r\n      // resolve fallthrough attrs\r\n      let attrs = instance.inheritAttrs !== false ? instance.attrs : undefined\r\n      let hasCloned = false\r\n\r\n      let cur = instance\r\n      while (true) {\r\n        const scopeId = cur.vnode.scopeId\r\n        if (scopeId) {\r\n          if (!hasCloned) {\r\n            attrs = { ...attrs }\r\n            hasCloned = true\r\n          }\r\n          attrs![scopeId] = ''\r\n        }\r\n        const parent = cur.parent\r\n        if (parent && parent.subTree && parent.subTree === cur.vnode) {\r\n          // parent is a non-SSR compiled component and is rendering this\r\n          // component as root. inherit its scopeId if present.\r\n          cur = parent\r\n        } else {\r\n          break\r\n        }\r\n      }\r\n\r\n      if (slotScopeId) {\r\n        if (!hasCloned) attrs = { ...attrs }\r\n        attrs![slotScopeId.trim()] = ''\r\n      }\r\n\r\n      // set current rendering instance for asset resolution\r\n      const prev = setCurrentRenderingInstance(instance)\r\n      ssrRender(\r\n        instance.proxy,\r\n        push,\r\n        instance,\r\n        attrs,\r\n        // compiler-optimized bindings\r\n        instance.props,\r\n        instance.setupState,\r\n        instance.data,\r\n        instance.ctx\r\n      )\r\n      setCurrentRenderingInstance(prev)\r\n    } else if (instance.render && instance.render !== NOOP) {\r\n      renderVNode(\r\n        push,\r\n        (instance.subTree = renderComponentRoot(instance)),\r\n        instance,\r\n        slotScopeId\r\n      )\r\n    } else {\r\n      const componentName = comp.name || comp.__file || `<Anonymous>`\r\n      warn(`Component ${componentName} is missing template or render function.`)\r\n      push(`<!---->`)\r\n    }\r\n  }\r\n  return getBuffer()\r\n}\r\n\r\nexport function renderVNode(\r\n  push: PushFn,\r\n  vnode: VNode,\r\n  parentComponent: ComponentInternalInstance,\r\n  slotScopeId?: string\r\n) {\r\n  const { type, shapeFlag, children } = vnode\r\n  switch (type) {\r\n    case Text:\r\n      push(escapeHtml(children as string))\r\n      break\r\n    case Comment:\r\n      push(\r\n        children ? `<!--${escapeHtmlComment(children as string)}-->` : `<!---->`\r\n      )\r\n      break\r\n    case Static:\r\n      push(children as string)\r\n      break\r\n    case Fragment:\r\n      if (vnode.slotScopeIds) {\r\n        slotScopeId =\r\n          (slotScopeId ? slotScopeId + ' ' : '') + vnode.slotScopeIds.join(' ')\r\n      }\r\n      push(`<!--[-->`) // open\r\n      renderVNodeChildren(\r\n        push,\r\n        children as VNodeArrayChildren,\r\n        parentComponent,\r\n        slotScopeId\r\n      )\r\n      push(`<!--]-->`) // close\r\n      break\r\n    default:\r\n      if (shapeFlag & ShapeFlags.ELEMENT) {\r\n        renderElementVNode(push, vnode, parentComponent, slotScopeId)\r\n      } else if (shapeFlag & ShapeFlags.COMPONENT) {\r\n        push(renderComponentVNode(vnode, parentComponent, slotScopeId))\r\n      } else if (shapeFlag & ShapeFlags.TELEPORT) {\r\n        renderTeleportVNode(push, vnode, parentComponent, slotScopeId)\r\n      } else if (shapeFlag & ShapeFlags.SUSPENSE) {\r\n        renderVNode(push, vnode.ssContent!, parentComponent, slotScopeId)\r\n      } else {\r\n        warn(\r\n          '[@vue/server-renderer] Invalid VNode type:',\r\n          type,\r\n          `(${typeof type})`\r\n        )\r\n      }\r\n  }\r\n}\r\n\r\nexport function renderVNodeChildren(\r\n  push: PushFn,\r\n  children: VNodeArrayChildren,\r\n  parentComponent: ComponentInternalInstance,\r\n  slotScopeId: string | undefined\r\n) {\r\n  for (let i = 0; i < children.length; i++) {\r\n    renderVNode(push, normalizeVNode(children[i]), parentComponent, slotScopeId)\r\n  }\r\n}\r\n\r\nfunction renderElementVNode(\r\n  push: PushFn,\r\n  vnode: VNode,\r\n  parentComponent: ComponentInternalInstance,\r\n  slotScopeId: string | undefined\r\n) {\r\n  const tag = vnode.type as string\r\n  let { props, children, shapeFlag, scopeId, dirs } = vnode\r\n  let openTag = `<${tag}`\r\n\r\n  if (dirs) {\r\n    props = applySSRDirectives(vnode, props, dirs)\r\n  }\r\n\r\n  if (props) {\r\n    openTag += ssrRenderAttrs(props, tag)\r\n  }\r\n\r\n  if (scopeId) {\r\n    openTag += ` ${scopeId}`\r\n  }\r\n  // inherit parent chain scope id if this is the root node\r\n  let curParent: ComponentInternalInstance | null = parentComponent\r\n  let curVnode = vnode\r\n  while (curParent && curVnode === curParent.subTree) {\r\n    curVnode = curParent.vnode\r\n    if (curVnode.scopeId) {\r\n      openTag += ` ${curVnode.scopeId}`\r\n    }\r\n    curParent = curParent.parent\r\n  }\r\n  if (slotScopeId) {\r\n    openTag += ` ${slotScopeId}`\r\n  }\r\n\r\n  push(openTag + `>`)\r\n  if (!isVoidTag(tag)) {\r\n    let hasChildrenOverride = false\r\n    if (props) {\r\n      if (props.innerHTML) {\r\n        hasChildrenOverride = true\r\n        push(props.innerHTML)\r\n      } else if (props.textContent) {\r\n        hasChildrenOverride = true\r\n        push(escapeHtml(props.textContent))\r\n      } else if (tag === 'textarea' && props.value) {\r\n        hasChildrenOverride = true\r\n        push(escapeHtml(props.value))\r\n      }\r\n    }\r\n    if (!hasChildrenOverride) {\r\n      if (shapeFlag & ShapeFlags.TEXT_CHILDREN) {\r\n        push(escapeHtml(children as string))\r\n      } else if (shapeFlag & ShapeFlags.ARRAY_CHILDREN) {\r\n        renderVNodeChildren(\r\n          push,\r\n          children as VNodeArrayChildren,\r\n          parentComponent,\r\n          slotScopeId\r\n        )\r\n      }\r\n    }\r\n    push(`</${tag}>`)\r\n  }\r\n}\r\n\r\nfunction applySSRDirectives(\r\n  vnode: VNode,\r\n  rawProps: VNodeProps | null,\r\n  dirs: DirectiveBinding[]\r\n): VNodeProps {\r\n  const toMerge: VNodeProps[] = []\r\n  for (let i = 0; i < dirs.length; i++) {\r\n    const binding = dirs[i]\r\n    const {\r\n      dir: { getSSRProps }\r\n    } = binding\r\n    if (getSSRProps) {\r\n      const props = getSSRProps(binding, vnode)\r\n      if (props) toMerge.push(props)\r\n    }\r\n  }\r\n  return mergeProps(rawProps || {}, ...toMerge)\r\n}\r\n\r\nfunction renderTeleportVNode(\r\n  push: PushFn,\r\n  vnode: VNode,\r\n  parentComponent: ComponentInternalInstance,\r\n  slotScopeId: string | undefined\r\n) {\r\n  const target = vnode.props && vnode.props.to\r\n  const disabled = vnode.props && vnode.props.disabled\r\n  if (!target) {\r\n    if (!disabled) {\r\n      warn(`[@vue/server-renderer] Teleport is missing target prop.`)\r\n    }\r\n    return []\r\n  }\r\n  if (!isString(target)) {\r\n    warn(\r\n      `[@vue/server-renderer] Teleport target must be a query selector string.`\r\n    )\r\n    return []\r\n  }\r\n  ssrRenderTeleport(\r\n    push,\r\n    push => {\r\n      renderVNodeChildren(\r\n        push,\r\n        vnode.children as VNodeArrayChildren,\r\n        parentComponent,\r\n        slotScopeId\r\n      )\r\n    },\r\n    target,\r\n    disabled || disabled === '',\r\n    parentComponent\r\n  )\r\n}\r\n","import {\r\n  App,\r\n  createApp,\r\n  createVNode,\r\n  ssrContextKey,\r\n  ssrUtils,\r\n  VNode\r\n} from 'vue'\r\nimport { isPromise, isString } from '@vue/shared'\r\nimport { SSRContext, renderComponentVNode, SSRBuffer } from './render'\r\n\r\nconst { isVNode } = ssrUtils\r\n\r\nasync function unrollBuffer(buffer: SSRBuffer): Promise<string> {\r\n  if (buffer.hasAsync) {\r\n    let ret = ''\r\n    for (let i = 0; i < buffer.length; i++) {\r\n      let item = buffer[i]\r\n      if (isPromise(item)) {\r\n        item = await item\r\n      }\r\n      if (isString(item)) {\r\n        ret += item\r\n      } else {\r\n        ret += await unrollBuffer(item)\r\n      }\r\n    }\r\n    return ret\r\n  } else {\r\n    // sync buffer can be more efficiently unrolled without unnecessary await\r\n    // ticks\r\n    return unrollBufferSync(buffer)\r\n  }\r\n}\r\n\r\nfunction unrollBufferSync(buffer: SSRBuffer): string {\r\n  let ret = ''\r\n  for (let i = 0; i < buffer.length; i++) {\r\n    let item = buffer[i]\r\n    if (isString(item)) {\r\n      ret += item\r\n    } else {\r\n      // since this is a sync buffer, child buffers are never promises\r\n      ret += unrollBufferSync(item as SSRBuffer)\r\n    }\r\n  }\r\n  return ret\r\n}\r\n\r\nexport async function renderToString(\r\n  input: App | VNode,\r\n  context: SSRContext = {}\r\n): Promise<string> {\r\n  if (isVNode(input)) {\r\n    // raw vnode, wrap with app (for context)\r\n    return renderToString(createApp({ render: () => input }), context)\r\n  }\r\n\r\n  // rendering an app\r\n  const vnode = createVNode(input._component, input._props)\r\n  vnode.appContext = input._context\r\n  // provide the ssr context to the tree\r\n  input.provide(ssrContextKey, context)\r\n  const buffer = await renderComponentVNode(vnode)\r\n\r\n  const result = await unrollBuffer(buffer as SSRBuffer)\r\n\r\n  await resolveTeleports(context)\r\n\r\n  return result\r\n}\r\n\r\nexport async function resolveTeleports(context: SSRContext) {\r\n  if (context.__teleportBuffers) {\r\n    context.teleports = context.teleports || {}\r\n    for (const key in context.__teleportBuffers) {\r\n      // note: it's OK to await sequentially here because the Promises were\r\n      // created eagerly in parallel.\r\n      context.teleports[key] = await unrollBuffer(\r\n        await Promise.all([context.__teleportBuffers[key]])\r\n      )\r\n    }\r\n  }\r\n}\r\n","import {\r\n  App,\r\n  VNode,\r\n  createVNode,\r\n  ssrUtils,\r\n  createApp,\r\n  ssrContextKey\r\n} from 'vue'\r\nimport { isString, isPromise } from '@vue/shared'\r\nimport { renderComponentVNode, SSRBuffer, SSRContext } from './render'\r\nimport { Readable, Writable } from 'stream'\r\nimport { resolveTeleports } from './renderToString'\r\n\r\nconst { isVNode } = ssrUtils\r\n\r\nexport interface SimpleReadable {\r\n  push(chunk: string | null): void\r\n  destroy(err: any): void\r\n}\r\n\r\nasync function unrollBuffer(\r\n  buffer: SSRBuffer,\r\n  stream: SimpleReadable\r\n): Promise<void> {\r\n  if (buffer.hasAsync) {\r\n    for (let i = 0; i < buffer.length; i++) {\r\n      let item = buffer[i]\r\n      if (isPromise(item)) {\r\n        item = await item\r\n      }\r\n      if (isString(item)) {\r\n        stream.push(item)\r\n      } else {\r\n        await unrollBuffer(item, stream)\r\n      }\r\n    }\r\n  } else {\r\n    // sync buffer can be more efficiently unrolled without unnecessary await\r\n    // ticks\r\n    unrollBufferSync(buffer, stream)\r\n  }\r\n}\r\n\r\nfunction unrollBufferSync(buffer: SSRBuffer, stream: SimpleReadable) {\r\n  for (let i = 0; i < buffer.length; i++) {\r\n    let item = buffer[i]\r\n    if (isString(item)) {\r\n      stream.push(item)\r\n    } else {\r\n      // since this is a sync buffer, child buffers are never promises\r\n      unrollBufferSync(item as SSRBuffer, stream)\r\n    }\r\n  }\r\n}\r\n\r\nexport function renderToSimpleStream<T extends SimpleReadable>(\r\n  input: App | VNode,\r\n  context: SSRContext,\r\n  stream: T\r\n): T {\r\n  if (isVNode(input)) {\r\n    // raw vnode, wrap with app (for context)\r\n    return renderToSimpleStream(\r\n      createApp({ render: () => input }),\r\n      context,\r\n      stream\r\n    )\r\n  }\r\n\r\n  // rendering an app\r\n  const vnode = createVNode(input._component, input._props)\r\n  vnode.appContext = input._context\r\n  // provide the ssr context to the tree\r\n  input.provide(ssrContextKey, context)\r\n\r\n  Promise.resolve(renderComponentVNode(vnode))\r\n    .then(buffer => unrollBuffer(buffer, stream))\r\n    .then(() => resolveTeleports(context))\r\n    .then(() => stream.push(null))\r\n    .catch(error => {\r\n      stream.destroy(error)\r\n    })\r\n\r\n  return stream\r\n}\r\n\r\n/**\r\n * @deprecated\r\n */\r\nexport function renderToStream(\r\n  input: App | VNode,\r\n  context: SSRContext = {}\r\n): Readable {\r\n  console.warn(\r\n    `[@vue/server-renderer] renderToStream is deprecated - use renderToNodeStream instead.`\r\n  )\r\n  return renderToNodeStream(input, context)\r\n}\r\n\r\nexport function renderToNodeStream(\r\n  input: App | VNode,\r\n  context: SSRContext = {}\r\n): Readable {\r\n  const stream: Readable = __NODE_JS__\r\n    ? new (require('stream').Readable)({ read() {} })\r\n    : null\r\n\r\n  if (!stream) {\r\n    throw new Error(\r\n      `ESM build of renderToStream() does not support renderToNodeStream(). ` +\r\n        `Use pipeToNodeWritable() with an existing Node.js Writable stream ` +\r\n        `instance instead.`\r\n    )\r\n  }\r\n\r\n  return renderToSimpleStream(input, context, stream)\r\n}\r\n\r\nexport function pipeToNodeWritable(\r\n  input: App | VNode,\r\n  context: SSRContext = {},\r\n  writable: Writable\r\n) {\r\n  renderToSimpleStream(input, context, {\r\n    push(content) {\r\n      if (content != null) {\r\n        writable.write(content)\r\n      } else {\r\n        writable.end()\r\n      }\r\n    },\r\n    destroy(err) {\r\n      writable.destroy(err)\r\n    }\r\n  })\r\n}\r\n\r\nexport function renderToWebStream(\r\n  input: App | VNode,\r\n  context: SSRContext = {}\r\n): ReadableStream {\r\n  if (typeof ReadableStream !== 'function') {\r\n    throw new Error(\r\n      `ReadableStream constructor is not available in the global scope. ` +\r\n        `If the target environment does support web streams, consider using ` +\r\n        `pipeToWebWritable() with an existing WritableStream instance instead.`\r\n    )\r\n  }\r\n\r\n  const encoder = new TextEncoder()\r\n  let cancelled = false\r\n\r\n  return new ReadableStream({\r\n    start(controller) {\r\n      renderToSimpleStream(input, context, {\r\n        push(content) {\r\n          if (cancelled) return\r\n          if (content != null) {\r\n            controller.enqueue(encoder.encode(content))\r\n          } else {\r\n            controller.close()\r\n          }\r\n        },\r\n        destroy(err) {\r\n          controller.error(err)\r\n        }\r\n      })\r\n    },\r\n    cancel() {\r\n      cancelled = true\r\n    }\r\n  })\r\n}\r\n\r\nexport function pipeToWebWritable(\r\n  input: App | VNode,\r\n  context: SSRContext = {},\r\n  writable: WritableStream\r\n): void {\r\n  const writer = writable.getWriter()\r\n  const encoder = new TextEncoder()\r\n\r\n  // #4287 CloudFlare workers do not implement `ready` property\r\n  let hasReady = false\r\n  try {\r\n    hasReady = isPromise(writer.ready)\r\n  } catch (e: any) {}\r\n\r\n  renderToSimpleStream(input, context, {\r\n    async push(content) {\r\n      if (hasReady) {\r\n        await writer.ready\r\n      }\r\n      if (content != null) {\r\n        return writer.write(encoder.encode(content))\r\n      } else {\r\n        return writer.close()\r\n      }\r\n    },\r\n    destroy(err) {\r\n      // TODO better error handling?\r\n      console.log(err)\r\n      writer.close()\r\n    }\r\n  })\r\n}\r\n","import { Component, ComponentInternalInstance, createVNode, Slots } from 'vue'\r\nimport { Props, renderComponentVNode, SSRBuffer } from '../render'\r\nimport { SSRSlots } from './ssrRenderSlot'\r\n\r\nexport function ssrRenderComponent(\r\n  comp: Component,\r\n  props: Props | null = null,\r\n  children: Slots | SSRSlots | null = null,\r\n  parentComponent: ComponentInternalInstance | null = null,\r\n  slotScopeId?: string\r\n): SSRBuffer | Promise<SSRBuffer> {\r\n  return renderComponentVNode(\r\n    createVNode(comp, props, children),\r\n    parentComponent,\r\n    slotScopeId\r\n  )\r\n}\r\n","import { ComponentInternalInstance, Slots } from 'vue'\r\nimport { Props, PushFn, renderVNodeChildren, SSRBufferItem } from '../render'\r\nimport { isArray } from '@vue/shared'\r\n\r\nexport type SSRSlots = Record<string, SSRSlot>\r\nexport type SSRSlot = (\r\n  props: Props,\r\n  push: PushFn,\r\n  parentComponent: ComponentInternalInstance | null,\r\n  scopeId: string | null\r\n) => void\r\n\r\nexport function ssrRenderSlot(\r\n  slots: Slots | SSRSlots,\r\n  slotName: string,\r\n  slotProps: Props,\r\n  fallbackRenderFn: (() => void) | null,\r\n  push: PushFn,\r\n  parentComponent: ComponentInternalInstance,\r\n  slotScopeId?: string\r\n) {\r\n  // template-compiled slots are always rendered as fragments\r\n  push(`<!--[-->`)\r\n  ssrRenderSlotInner(\r\n    slots,\r\n    slotName,\r\n    slotProps,\r\n    fallbackRenderFn,\r\n    push,\r\n    parentComponent,\r\n    slotScopeId\r\n  )\r\n  push(`<!--]-->`)\r\n}\r\n\r\nexport function ssrRenderSlotInner(\r\n  slots: Slots | SSRSlots,\r\n  slotName: string,\r\n  slotProps: Props,\r\n  fallbackRenderFn: (() => void) | null,\r\n  push: PushFn,\r\n  parentComponent: ComponentInternalInstance,\r\n  slotScopeId?: string,\r\n  transition?: boolean\r\n) {\r\n  const slotFn = slots[slotName]\r\n  if (slotFn) {\r\n    const slotBuffer: SSRBufferItem[] = []\r\n    const bufferedPush = (item: SSRBufferItem) => {\r\n      slotBuffer.push(item)\r\n    }\r\n    const ret = slotFn(\r\n      slotProps,\r\n      bufferedPush,\r\n      parentComponent,\r\n      slotScopeId ? ' ' + slotScopeId : ''\r\n    )\r\n    if (isArray(ret)) {\r\n      // normal slot\r\n      renderVNodeChildren(push, ret, parentComponent, slotScopeId)\r\n    } else {\r\n      // ssr slot.\r\n      // check if the slot renders all comments, in which case use the fallback\r\n      let isEmptySlot = true\r\n      if (transition) {\r\n        isEmptySlot = false\r\n      } else {\r\n        for (let i = 0; i < slotBuffer.length; i++) {\r\n          if (!isComment(slotBuffer[i])) {\r\n            isEmptySlot = false\r\n            break\r\n          }\r\n        }\r\n      }\r\n      if (isEmptySlot) {\r\n        if (fallbackRenderFn) {\r\n          fallbackRenderFn()\r\n        }\r\n      } else {\r\n        for (let i = 0; i < slotBuffer.length; i++) {\r\n          push(slotBuffer[i])\r\n        }\r\n      }\r\n    }\r\n  } else if (fallbackRenderFn) {\r\n    fallbackRenderFn()\r\n  }\r\n}\r\n\r\nconst commentTestRE = /^<!--.*-->$/s\r\nconst commentRE = /<!--[^]*?-->/gm\r\nfunction isComment(item: SSRBufferItem) {\r\n  if (typeof item !== 'string' || !commentTestRE.test(item)) return false\r\n  // if item is '<!---->' or '<!--[-->' or '<!--]-->', return true directly\r\n  if (item.length <= 8) return true\r\n  return !item.replace(commentRE, '').trim()\r\n}\r\n","import { escapeHtml, toDisplayString } from '@vue/shared'\r\n\r\nexport function ssrInterpolate(value: unknown): string {\r\n  return escapeHtml(toDisplayString(value))\r\n}\r\n","import { isArray, isString, isObject } from '@vue/shared'\r\nimport { warn } from '@vue/runtime-core'\r\n\r\nexport function ssrRenderList(\r\n  source: unknown,\r\n  renderItem: (value: unknown, key: string | number, index?: number) => void\r\n) {\r\n  if (isArray(source) || isString(source)) {\r\n    for (let i = 0, l = source.length; i < l; i++) {\r\n      renderItem(source[i], i)\r\n    }\r\n  } else if (typeof source === 'number') {\r\n    if (__DEV__ && !Number.isInteger(source)) {\r\n      warn(`The v-for range expect an integer value but got ${source}.`)\r\n      return\r\n    }\r\n    for (let i = 0; i < source; i++) {\r\n      renderItem(i + 1, i)\r\n    }\r\n  } else if (isObject(source)) {\r\n    if (source[Symbol.iterator as any]) {\r\n      const arr = Array.from(source as Iterable<any>)\r\n      for (let i = 0, l = arr.length; i < l; i++) {\r\n        renderItem(arr[i], i)\r\n      }\r\n    } else {\r\n      const keys = Object.keys(source)\r\n      for (let i = 0, l = keys.length; i < l; i++) {\r\n        const key = keys[i]\r\n        renderItem(source[key], key, i)\r\n      }\r\n    }\r\n  }\r\n}\r\n","import { PushFn } from '../render'\r\n\r\nexport async function ssrRenderSuspense(\r\n  push: PushFn,\r\n  { default: renderContent }: Record<string, (() => void) | undefined>\r\n) {\r\n  if (renderContent) {\r\n    renderContent()\r\n  } else {\r\n    push(`<!---->`)\r\n  }\r\n}\r\n","import { ComponentPublicInstance, Directive } from '@vue/runtime-core'\r\n\r\nexport function ssrGetDirectiveProps(\r\n  instance: ComponentPublicInstance,\r\n  dir: Directive,\r\n  value?: any,\r\n  arg?: string,\r\n  modifiers: Record<string, boolean> = {}\r\n): Record<string, any> {\r\n  if (typeof dir !== 'function' && dir.getSSRProps) {\r\n    return (\r\n      dir.getSSRProps(\r\n        {\r\n          dir,\r\n          instance,\r\n          value,\r\n          oldValue: undefined,\r\n          arg,\r\n          modifiers\r\n        },\r\n        null as any\r\n      ) || {}\r\n    )\r\n  }\r\n  return {}\r\n}\r\n","import { looseEqual, looseIndexOf, isArray } from '@vue/shared'\r\nimport { ssrRenderAttr } from './ssrRenderAttrs'\r\n\r\nexport const ssrLooseEqual = looseEqual as (a: unknown, b: unknown) => boolean\r\n\r\nexport function ssrLooseContain(arr: unknown[], value: unknown): boolean {\r\n  return looseIndexOf(arr, value) > -1\r\n}\r\n\r\n// for <input :type=\"type\" v-model=\"model\" value=\"value\">\r\nexport function ssrRenderDynamicModel(\r\n  type: unknown,\r\n  model: unknown,\r\n  value: unknown\r\n) {\r\n  switch (type) {\r\n    case 'radio':\r\n      return looseEqual(model, value) ? ' checked' : ''\r\n    case 'checkbox':\r\n      return (isArray(model) ? ssrLooseContain(model, value) : model)\r\n        ? ' checked'\r\n        : ''\r\n    default:\r\n      // text types\r\n      return ssrRenderAttr('value', model)\r\n  }\r\n}\r\n\r\n// for <input v-bind=\"obj\" v-model=\"model\">\r\nexport function ssrGetDynamicModelProps(\r\n  existingProps: any = {},\r\n  model: unknown\r\n) {\r\n  const { type, value } = existingProps\r\n  switch (type) {\r\n    case 'radio':\r\n      return looseEqual(model, value) ? { checked: true } : null\r\n    case 'checkbox':\r\n      return (isArray(model) ? ssrLooseContain(model, value) : model)\r\n        ? { checked: true }\r\n        : null\r\n    default:\r\n      // text types\r\n      return { value: model }\r\n  }\r\n}\r\n","import { initDirectivesForSSR } from 'vue'\r\ninitDirectivesForSSR()\r\n\r\n// public\r\nexport { SSRContext } from './render'\r\nexport { renderToString } from './renderToString'\r\nexport {\r\n  renderToSimpleStream,\r\n  renderToNodeStream,\r\n  pipeToNodeWritable,\r\n  renderToWebStream,\r\n  pipeToWebWritable,\r\n  SimpleReadable,\r\n  // deprecated\r\n  renderToStream\r\n} from './renderToStream'\r\n\r\n// internal runtime helpers\r\nexport { renderVNode as ssrRenderVNode } from './render'\r\nexport { ssrRenderComponent } from './helpers/ssrRenderComponent'\r\nexport { ssrRenderSlot, ssrRenderSlotInner } from './helpers/ssrRenderSlot'\r\nexport { ssrRenderTeleport } from './helpers/ssrRenderTeleport'\r\nexport {\r\n  ssrRenderClass,\r\n  ssrRenderStyle,\r\n  ssrRenderAttrs,\r\n  ssrRenderAttr,\r\n  ssrRenderDynamicAttr\r\n} from './helpers/ssrRenderAttrs'\r\nexport { ssrInterpolate } from './helpers/ssrInterpolate'\r\nexport { ssrRenderList } from './helpers/ssrRenderList'\r\nexport { ssrRenderSuspense } from './helpers/ssrRenderSuspense'\r\nexport { ssrGetDirectiveProps } from './helpers/ssrGetDirectiveProps'\r\nexport { includeBooleanAttr as ssrIncludeBooleanAttr } from '@vue/shared'\r\n\r\n// v-model helpers\r\nexport {\r\n  ssrLooseEqual,\r\n  ssrLooseContain,\r\n  ssrRenderDynamicModel,\r\n  ssrGetDynamicModelProps\r\n} from './helpers/ssrVModelHelpers'\r\n"],"names":["makeMap","isOn","propsToAttrMap","isBooleanAttr","includeBooleanAttr","isSSRSafeAttrName","escapeHtml","normalizeClass","isString","normalizeStyle","stringifyStyle","extend","NO","isFunction","compile","ssrContextKey","ssrUtils","isPromise","isArray","NOOP","warn","Text","Comment","escapeHtmlComment","Static","Fragment","isVoidTag","mergeProps","createApp","createVNode","isVNode","unrollBuffer","unrollBufferSync","toDisplayString","isObject","looseEqual","looseIndexOf","initDirectivesForSSR"],"mappings":"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"}